(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{47:function(e,t,i){"use strict";i.r(t);var s=i(7),r=i(0),a=i(5);class n{static routeRegExp(e){let t=e.split("[");if(t.length>2)throw new Error("Invalid use of optional params");let i=[],s=t[0].replace(/{([^}]+)}/g,function(e,t){return i.push(t),"([^/]+)"}).replace(/\//g,"\\/"),r="";return t[1]&&(r="(?:"+t[1].slice(0,-1).replace(/{([^}]+)}/g,function(e,t){let[s,r="[^/]+"]=t.split(":");return i.push(s),`(${r})`}).replace(/\//g,"\\/")+")?"),[new RegExp("^"+s+r+"$"),i]}static isStatic(e){return!e.match(/[[{]/)}constructor(e,t){if(this.route=e,this.callback=t,n.isStatic(e))this.type="s",this.pattern=null,this.args=[];else{let t=n.routeRegExp(e);this.type="v",this.pattern=t[0],this.args=t[1]}}getExecutorFor(e){if("s"===this.type){if(e===this.route)return{handler:this,args:{}}}else if("v"===this.type){let t=e.match(this.pattern);if(t)return{handler:this,args:this.args.reduce((e,i,s)=>(e[i]=t[s+1],e),{})}}}}const o=i(4)("xin:components:app");class h extends a.a{get props(){return{title:{type:String,observer:"_titleChanged"},manual:{type:Boolean},mode:{type:String,value:"hash"},rootUri:{type:String,value:"/"},hash:{type:String,value:"#!"},startDelay:{type:Number,value:100},location:{type:Object,value:()=>window.location},history:{type:Object,value:()=>window.history}}}get hashRegexp(){return this._hashRegexp&&this._hash===this.hash||(this._hashRegexp=new RegExp(`${this.hash}(.*)$`),this._hash=this.hash),this._hashRegexp}notFound(e){console.warn(`Route not found: ${e}`)}_titleChanged(e){e&&(document.title=e)}created(){this.__appSignature=!0,this.handlers=[],this.middlewares=[],this.__started=!1,this.__starting=!1,this.classList.add("xin-app")}attached(){this.manual||this.async(()=>{this.start()},1)}detached(){super.detached(),"history"===this.mode?(Object(r.c)(window).off("popstate",this.__navCallback),Object(r.c)(document).off("click",this.__clickCallback),delete this.__clickCallback):Object(r.c)(window).off("hashchange",this.__navCallback),delete this.__navCallback}route(e,t){this.handlers.push(new n(e,t))}async start(){if(this.__started||this.__starting)return;this.__middlewareChainRun=function(e){for(let t of e)if("function"!=typeof t)throw new TypeError("Middleware must be composed of functions!");return(t,i)=>{let s=-1;return function r(a){if(a<=s)throw new Error("next() called multiple times");s=a;let n=e[a];a===e.length&&(n=i);if(!n)return;return n(t,()=>r(a+1))}(0)}}(this.middlewares),this.__listenNavigation(),o(`Starting ${this.is}:${this.__id} ...`),this.__starting=!0;let e=await this.__execute();this.async(()=>{this.__starting=!1,e&&(o(`Started ${this.is}:${this.__id}`),this.__started=!0,this.fire("started"))},this.startDelay)}__listenNavigation(){this.__navCallback=(()=>{this.__execute()}),"history"===this.mode?(this.__clickCallback=(e=>{if(!e.defaultPrevented&&"A"===e.target.nodeName&&""===e.target.target){e.preventDefault();let t={url:e.target.getAttribute("href")};this.history.pushState(t,e.target.innerHTML,e.target.href),this.__navCallback()}}),Object(r.c)(window).on("popstate",this.__navCallback),Object(r.c)(document).on("click",this.__clickCallback)):Object(r.c)(window).on("hashchange",this.__navCallback)}get started(){return this.__started||!1}getFragmentExecutors(e){return this.handlers.reduce((t,i)=>{let s=i.getExecutorFor(e);return s&&t.push(s),t},[])}async __execute(){let e=this.__navParameters;delete this.__navParameters;let t=this.getFragment(),i={app:this,uri:t,navParameters:e};return!1!==await this.__middlewareChainRun(i,()=>{let s=this.getFragmentExecutors(i.uri);if(0===s.length)return this.notFound(t),void this.fire("route-not-found",t);s.forEach(t=>{let s=Object.assign({},t.args,e);t.handler.callback(s,i)})})&&(this.fire("navigated",i),!0)}navigate(e="/",t={}){if(this.__navParameters=t.parameters,"history"===this.mode){let i=this.rootUri+e.toString().replace(/\/$/,"").replace(/^\//,"");this.location.href.replace(this.location.origin,"")!==i&&(this.history[t.replace?"replaceState":"pushState"](this.__navParameters,document.title,i),this.__execute())}else t.replace?this.location.replace(this.hash+e):this.location.hash=this.hash+e;return this}use(e){this.middlewares.push(e)}getFragment(){try{let e;if("history"===this.mode)e=(e=decodeURI(this.location.pathname+this.location.search)).replace(/\?(.*)$/,""),e="/"===this.rootUri?e:e.replace(this.rootUri,"");else{let t=this.location.href.match(this.hashRegexp);e=t?t[1]:""}return"/"+e.toString().replace(/\/$/,"").replace(/^\//,"")}catch(e){return console.error("Fragment is not match any pattern, fallback to /"),"/"}}}Object(a.c)("xin-app",h);var l=i(3);Object(a.c)("xin-fixture",class extends a.a{static create(e,t={}){const i=document.createElement("div");i.innerHTML=`<xin-fixture><template>${e}</template></xin-fixture>`;const s=i.firstElementChild;return s.__initialData=t,document.body.appendChild(s),new Promise(e=>e(s))}attached(){super.attached(),this.set(this.__initialData),this.connected=!0,this.async(()=>this.fire("connected"))}detached(){super.detached(),this.connected=!1,this.fire("disconnected")}dispose(){this.parentElement.removeChild(this)}async waitConnected(e){this.connected||await this.waitFor("connected"),await l.a.sleep(e)}});class c extends a.a{attached(){super.attached(),this.__app.use(this.callback())}}Object(a.c)("xin-pager",class extends a.a{ready(){super.ready();for(let e=this.firstElementChild,t=0;e;e=e.nextElementSibling,t++)e.setAttribute("index",t)}setFocus(e){if(e){let t=e.getAttribute("index"),i=this.focused$?this.focused$.getAttribute("index"):-1;i<t?this.__transitionForward(this.focused$,e):i>t&&this.__transitionBackward(this.focused$,e)}else this.focused$&&this.focused$.setFocus(!1);this.focused$=e}__transitionBackward(e,t){Promise.all([t.inFx.play(-1),e.outFx.play(-1)]).then(()=>{e.setVisible(!1),t.setVisible(!0),e.setFocus(!1),t.setFocus(!0),this.$focused=t,t.inFx.stop(),e.outFx.stop()})}__transitionForward(e,t){if(e)Promise.all([t.inFx.play(1),e.outFx.play(1)]).then(()=>{e.setVisible(!1),t.setVisible(!0),e.setFocus(!1),t.setFocus(!0),this.$focused=t,t.inFx.stop(),e.outFx.stop()});else{let e=new r.a({element:t,transition:"none"});e.play("in",1).then(()=>{t.setVisible(!0),t.setFocus(!0),this.$focused=t,e.stop()})}}});class d extends a.b{constructor(e,t,i,s){super(),this.__templateInitialize(e,t.__templateModel,t.__templateMarker),this.is="$repeat-row",this.__id=this.__templateId,this.__repeat=t,this.__repeatAs=t.as,this.__repeatIndexAs=t.indexAs,this.__templateChildNodes.forEach(e=>{e.nodeType===window.Node.ELEMENT_NODE&&(e.__repeatModel=this)}),this.update(i,s),this.__templateRender()}get __app(){return this.__templateHost.__app}update(e,t){this[this.__repeatAs]=e,this[this.__repeatIndexAs]=t,this.notify(this.__repeatAs,e),this.notify(this.__repeatIndexAs,t)}set(e,t){return(e=this.__templateGetPathAsArray(e))[0]===this.__repeatAs||e[0]===this.__repeatIndexAs?super.set(e,t):this.__templateHost.set(e,t)}get(e){return(e=this.__templateGetPathAsArray(e))[0]===this.__repeatAs||e[0]===this.__repeatIndexAs?super.get(e):this.__templateHost.get(e)}notify(e,t){return(e=this.__templateGetPathAsArray(e))[0]===this.__repeatAs||e[0]===this.__repeatIndexAs?super.notify(e,t):this.__templateHost.notify(e,t)}}const u=()=>!0;Object(a.c)("xin-for",class extends a.a{get props(){return Object.assign({},super.props,{items:{type:Array,observer:"_itemsChanged(items, filter)"},as:{type:String,value:"item"},indexAs:{type:String,value:"index"},filter:{type:Function,observer:"_itemsChanged(items, filter)"},to:{type:String,value:""}})}created(){super.created(),this.rows=[]}__initTemplate(){if(this.__templateFor=this.firstElementChild,!this.__templateFor)throw new Error('Invalid xin-for definition, must be <xin-for items="[[items]]"><template>...</template></xin-for>');this.removeChild(this.__templateFor);let e=this,t=this.getAttribute("to");if(t){let i=this.parentElement.querySelector(t)||document.querySelector(t);if(!i)throw new Error(`xin-for render to unknown element ${t}`);e=document.createComment("marker-for"),i.appendChild(e)}a.b.prototype.__templateInitialize.call(this,null,this,e)}_itemsChanged(e,t){this.debounce("_itemsChanged",()=>{let t=0;if(e&&e.length){let i=this.filter||u;e.filter(i).forEach((e,i)=>{this.rows[i]?this.rows[i].update(e,i):this.rows.push(new d(this.__templateFor,this,e,i)),t++})}this.rows.splice(t).forEach(e=>{e.__templateUninitialize()})})}itemForElement(e){return this.modelForElement(e).get(this.as)}indexForElement(e){return this.modelForElement(e).get(this.indexAs)}modelForElement(e){for(;e&&!e.__repeatModel;)e=e.parentElement;return e.__repeatModel}});i(6);class p{constructor(e,t,i){this.name=t.nodeName.toLowerCase(),this.uri=t.getAttribute("uri"),this.element=t,this.loader=i,this.route=new n(this.uri),this.isStaticRoute=n.isStatic(this.uri),this.bag=e}get loaded(){if(this._loaded)return!0;return this.element.classList.contains("xin-view")?(this._loaded=!0,!0):void 0}async load(){if(!this.loaded){if(!this.loader)throw new Error(`Cannot lazy load view: ${this.name}`);this.loader.load(this),await Object(r.c)(this.element).waitFor("routed"),this._loaded=!0,this.element.querySelector(".xin-view")&&await l.a.sleep(300)}}}Object(a.c)("xin-lazy-view-middleware",class extends c{get props(){return Object.assign({},super.props,{loaders:{type:Array,value:()=>this.__repository.get("view.loaders")?this.__repository.get("view.loaders"):[]}})}created(){super.created(),this.views=[]}attached(){super.attached(),this.loaders.push({test:/^xin-/,load(e){if("xin-view"===e.name)return Promise.resolve().then(i.bind(null,6))}})}get(e){let t=this.views.find(t=>t.uri===e);return t||this.views.find(t=>!(!t.isStaticRoute||t.uri!==e)||t.route.getExecutorFor(e))}put(e){this.views.push(e)}ensure(e,t){0===this.views.length&&e.querySelectorAll("[lazy-view]").forEach(e=>{let t=this.loaders.find(t=>e.nodeName.toLowerCase().match(t.test)),i=new p(this,e,t);this.put(i)});let i=this.get(t);if(i)return i.load()}callback(e){const t=this;return async function(e,i){await t.ensure(e.app,e.uri),await i()}}});Object(a.c)("xin-title-middleware",class extends c{get props(){return Object.assign({},super.props,{defaultTitle:{type:String,value:"Unknown"}})}callback(e){const t=this;return async function(e,i){e.app.once("focus",e=>{document.title=e.target.title||t.defaultTitle}),await i()}}});Object(s.b)("x-redirect-middleware",class extends c{callback(e){return async function(e,t){-1===[...document.querySelector("xin-pager").children].map(e=>e.getAttribute("uri")).indexOf(e.uri)&&(e.uri="/not-found"),await t()}}});Object(s.b)("x-app",class extends h{get template(){return i(48)}})},48:function(e,t){e.exports="<x-redirect-middleware></x-redirect-middleware> <xin-lazy-view-middleware></xin-lazy-view-middleware> <xin-pager> <xin-view lazy-view uri=/ > <template> <div class=padding> <h1>xin</h1> <p>A WebComponents based framework. We love npm, webpack and ofcourse webcomponents specs.</p> <div class=list> <a href=#!/intro>Intro</a> <a href=#!/binding>Binding</a> <a href=#!/app-route>App, views and routing</a> <a href=#!/component>Component</a> <a href=#!/middleware>Middleware</a> <div class=list__separator>Components</div> <a href=#!/fixture>xin-fixture</a> <a href=#!/for>xin-for</a> <div class=list__separator>Advanced</div> <a href=#!/advanced>Advanced topics</a> </div> </div> </template> </xin-view> <x-intro lazy-view uri=/intro></x-intro> <x-binding lazy-view uri=/binding></x-binding> <x-app-route lazy-view uri=/app-route></x-app-route> <x-component lazy-view uri=/component></x-component> <x-middleware lazy-view uri=/middleware></x-middleware> <x-for lazy-view uri=/for></x-for> <xin-view lazy-view uri=/advanced> <div class=padding> <h2>Advanced topics</h2> <h3>Defer</h3> <ul> <li>Async</li> <li>Debounce</li> <li>NextFrame</li> </ul> <h3>Events</h3> <ul> <li>component.fire()</li> <li>component.on()</li> </ul> </div> </xin-view> <xin-view lazy-view uri=/not-found> <div class=aligner> <div class=aligner-item> <p> Oops, route not found. Sorry... </p> <a href=#!/ >Home</a> </div> </div> </xin-view> </xin-pager> "},6:function(e,t,i){"use strict";i.r(t);var s=i(5),r=i(0);class a extends s.a{get props(){const e=this.__repository.get("view.transitionIn")||this.__repository.get("view.transition")||"slide",t=this.__repository.get("view.transitionOut")||this.__repository.get("view.transition")||"fade";return Object.assign({},super.props,{uri:{type:String,required:!0},transitionIn:{type:String,value:e},transitionOut:{type:String,value:t},title:{type:String,value:()=>`View ${this.uri}`}})}focusing(){}focused(){}blurred(){}created(){super.created(),this.classList.add("xin-view")}ready(){super.ready(),this.inFx=new r.a({element:this,transition:this.transitionIn,method:"in"}),this.outFx=new r.a({element:this,transition:this.transitionOut,method:"out"})}attached(){super.attached(),this.classList.remove("xin-view--focus"),this.classList.remove("xin-view--visible"),this.__app?(this.__app.route(this.uri,e=>{this.focus(e)}),this.fire("routed")):console.error("Cannot route view to undefined app")}async focus(e={}){this.set("parameters",e),await this.focusing(e),this.fire("focusing",e),this.async(()=>{"setFocus"in this.parentElement?this.parentElement.setFocus(this):(this.setVisible(!0),this.setFocus(!0))})}setVisible(e){if(e)return this.classList.add("xin-view--visible"),void this.fire("show",{view:this});this.classList.remove("xin-view--visible"),this.querySelectorAll(".xin-view.xin-view--visible").forEach(t=>t.setVisible(e)),this.fire("hide",{view:this})}async setFocus(e){if(e)return this.classList.add("xin-view--focus"),await this.focused(),void this.fire("focus",{view:this});this.classList.remove("xin-view--focus"),this.querySelectorAll(".xin-view.xin-view--focus").forEach(t=>{"setFocus"in t.parentElement?t.parentElement.setFocus(null):t.setFocus(e)}),await this.blurred(),this.fire("blur",{view:this})}}Object(s.c)("xin-view",a),i.d(t,"View",function(){return a})}}]);